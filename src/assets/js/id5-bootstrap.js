!function(){"use strict";function e(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(t,i){for(var n=0;n<i.length;n++){var r=i[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,e(r.key),r)}}function n(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(t,i,n){return(i=e(i))in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}function o(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function a(e){for(var t=e+"=",i=decodeURIComponent(document.cookie).split(";"),n=0;n<i.length;n++){for(var r=i[n];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return""}function d(e){return 24*e*60*60*1e3}function s(e,t,i){var n="expires="+new Date((new Date).getTime()+i).toUTCString();document.cookie=e+"="+t+";"+n+";path=/"}var u=d(90),c="id5-true-link",l=c+"-refresh",m=l+"-exp",h="id5-tl-ts",p="id5-tl-redirect-timestamp",f="id5-tl-optout",v="trueLink",g=v+"Id",w=v+"Ts",I=v+"Expiry",T=v+"Oov",k="id5_trueLink_privacy",y=new WeakSet,b=function(){return n((function e(){t(this,e),o(this,y),r(this,"trueLinkId",void 0),r(this,"creationTimestamp",void 0),r(this,"redirected",!1),r(this,"initialized",!1),r(this,"redirectTimestamp",void 0),r(this,"oldTrueLinkId",void 0),r(this,"oldTrueLinkCreationTimestamp",void 0)}),[{key:"initTrueLinkId",value:function(e,t){if(Number.isInteger(e)&&!(e<=0)){this.initialized=!0;var i=new URLSearchParams(window.location.search),n=new C(e),r=i.get(g),o=(new Date).getTime(),p=a(c);if(r)if(this.redirected=!0,window.history.replaceState(null,null,this.getUpdatedUrl(i).toString()),"OPTOUT"===r){var v=parseInt(i.get(T)),k=isNaN(v)||v<0?90:v;s(f,!0,d(k)),n.recordRedirectCompleted(!0,!0)}else"ERROR"!==r&&(p&&(this.oldTrueLinkId=p,this.oldTrueLinkCreationTimestamp=parseInt(a(h))),s(c,r,u),s(m,o+1e3*parseInt(i.get(I)),u),s(l,o,u),s(h,i.get(w),u),this.trueLinkId=r,this.creationTimestamp=parseInt(i.get(w)),this.redirectTimestamp=o/1e3),n.recordRedirectCompleted(void 0!==this.trueLinkId);else{if(!0===a(f))return void console.log("ID5TL: Redirection aborted due to user optout");var b=parseInt(a(l)),R=parseInt(a(m)),S=this.isRefreshNeeded(o,b,R),N=parseInt(a(h));if(!p||S){if(function(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")}(y,this,L).call(this)||!0===t){console.log("ID5TL: Redirecting to TrueLink endpoint"),n.recordRedirect();var O=p?"&tlink="+encodeURIComponent(p)+"&tlinkct="+N:"";return void(window.location.href="https://id5-sync.com/true-link?partnerId="+e+O+"&trueLinkLocation="+encodeURIComponent(window.location.href))}return void console.log("ID5TL: Redirection aborted due to consent not being determined yet")}this.trueLinkId=p,this.creationTimestamp=N,this.redirectTimestamp=b/1e3}return console.log("ID5TL: Returning TrueLink of "+this.trueLinkId),this.trueLinkId}console.log("ID5TL: A valid partnerId was not provided, aborting")}},{key:"isRefreshNeeded",value:function(e,t,i){var n=d(1);return!t||(i?e>i:e>t+n)}},{key:"getUpdatedUrl",value:function(e){var t=new URLSearchParams(window.location.search);e.forEach((function(e,i){0===i.indexOf(v)&&t.delete(i)}));var i=new URL(window.location.href);return i.search=t.toString(),i}},{key:"setPrivacy",value:function(e){e?(window.localStorage.setItem(k,JSON.stringify(e)),!1===e.id5_consent&&(this.trueLinkId=void 0)):(window.localStorage.removeItem(k),this.trueLinkId=void 0)}},{key:"getTrueLinkId",value:function(){return this.trueLinkId}},{key:"getTrueLinkInfo",value:function(){return{booted:!0,redirected:this.redirected,id:this.trueLinkId,createdAt:this.creationTimestamp?this.creationTimestamp:null,redirectedAt:this.redirectTimestamp?this.redirectTimestamp:null,oldId:this.oldTrueLinkId,oldIdCreatedAt:this.oldTrueLinkCreationTimestamp}}}])}();function L(){var e=window.localStorage.getItem(k);return!!(e=e||window.localStorage.getItem("id5id_privacy"))&&!0===JSON.parse(e).id5_consent}var R="id5.trueLink.redirect",S="undefined"!=typeof Promise&&"undefined"!=typeof fetch,C=function(){return n((function e(i){t(this,e),this.url="https://diagnostics.id5-sync.com/measurements",this.partnerId=i.toString(),this.domain=window.location.hostname}),[{key:"recordRedirect",value:function(){var e=a(p),t=Number(e);if(Number.isInteger(t)&&t>0){var i=(new Date).getTime();this.publish([{name:R+".failure",tags:{domain:this.domain,partner:this.partnerId},values:[{timestamp:i,value:1}]}])}s(p,(new Date).getTime(),u)}},{key:"recordRedirectCompleted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=a(p),n=Number(i);if(Number.isInteger(n)&&n>0){var r=(new Date).getTime(),o=r-n;this.publish([{name:R+".latency",tags:{success:e,domain:this.domain,partner:this.partnerId,optout:t},values:[{timestamp:r,value:o}]}]),s(p,0,0)}}},{key:"publish",value:function(e){return S&&e&&e.length>0?fetch(this.url,{method:"POST",headers:{"Content-Type":"text/plain"},mode:"no-cors",body:JSON.stringify({measurements:e})}):Promise.resolve()}}])}();window.id5Bootstrap||(window.id5Bootstrap=new b,console.log("ID5TL: Id5 bootstrap loaded"))}();
//# sourceMappingURL=id5-bootstrap.js.map